name: task-providing-service

environment:
  _: ~
  local:
    PG_USER: task-providing-service
    PG_PASSWORD: secret
    PG_DATABASE: task-providing-service
  staging: ~

component:
  - type: postgres
    name: master
    enabled: true

task:
  - name: hello
    image: hello-world

  - name: ls
    image: platform/task/directory-lister

  - name: lint
    image: platform/task/golangci-lint

  - name: db migrate master
    image: platform/task/golang-migrate
    argument:
      workdir: /service/db/changelog/postgres/master
      command: >
        -path task-providing-service
        -database postgres://${PG_USER}:${PG_PASSWORD}@localhost:5432/${PG_DATABASE}?x-migrations-table="changelog"&x-migrations-table-quoted=true&sslmode=disable
        up

  - name: db migrate olap
    image: liquibase/liquibase
    argument:
      workdir: /service/db/changelog/postgres/olap/task-providing-service
      command: >
        --url=jdbc:postgresql://localhost:5432/${PG_DATABASE}
        --username=${PG_USER}
        --password=${PG_PASSWORD}
        --changeLogFile=master.changelog.sql
        --log-level=info
        update
